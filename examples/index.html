<!DOCTYPE html>
<html>
<head>
<style>
.classy {
  color: lime;
}
.notty {
  color: red;
}
</style>

<script type="text/javascript" src="../src/treetests.js"></script>
<script type="text/javascript" src="../src/app.js"></script>
<script type="text/javascript" src="../src/templater.js"></script>
<script type="text/javascript" src="../src/dom_ele.js"></script>
<script type="text/javascript" src="../src/view.js"></script>
<script type="text/javascript">
window.addEventListener('load', function () {
temp_ele = document.getElementById('tt-category-controller');
temp_ele_cat_child = document.getElementById('tt-category-child');
out_ele = document.getElementById('wowee');

app = treetests.app();

app.add_template('tt-cat-template', 'tt-category-controller');
app.add_template('tt-cat-child', 'tt-category-child');
app.add_template('tt-simple-template', 'tt-simple-template');
app.add_template('simple-entry', 'simple-entry');

test_tdata = {
  name: 'hoooeee wowzers',
  cat_passed: 22,
  cat_count: 22,
  children: [
    {
      type: 'test',
      name: 'yeppers',
      cat_passed: 20,
      cat_count: 20,
    },
    {
      type: 'category',
      name: 'yeppers 2',
      cat_passed: 10,
      cat_count: 20,
      children: [
        {
          type: 'category',
          name: 'child child a',
          cat_passed: 20,
          cat_count: 20,
          children: [],
        },
        {
          type: 'test',
          name: 'child child 2',
          cat_passed: 10,
          cat_count: 20,
        },
      ],
    },
  ]
};
app.add_controller('cat-cont', function () {
  this.set_model = function(model) {
    var test_data = model;
    this.cont_class = (test_data.cat_passed === test_data.cat_count && 'classy') || 'notty';
    this.children_cont_class = 'lil-classy';
  }
});
app.add_controller('fu-controller', function () {
  this.set_model = function(model) {
    var test_data = model;
    this.cont_class = (test_data.cat_passed < test_data.cat_count && 'classy') || 'notty';
    this.children_cont_class = 'lil-classy';
  }
});

app.inject('tt-cat-template', out_ele);
// app.inject('tt-simple-template', out_ele);
});
</script>
</head>
<body>
<div id="tt-templates" style="display: none;">
  <div id="tt-simple-template" data-tt-controller="cat-cont" data-tt-model="test_tdata">
    <span data-tt-text="model.name"></span>
    <tt-repeater data-tt-skip="!model.children || model.children.length === 0" data-tt-model="model.children">
      <tt-simple-template data-tt-model="model"></tt-simple_template>
    </tt-repeater>
  </div>

  <div id="simple-entry">
    <tt-simple-template data-tt-controller="cat-cont" data-tt-model="test_tdata"></tt-simple-template>
  </div>

  <div id="tt-category-controller" data-tt-controller="cat-cont" data-tt-model="model || test_tdata" data-tt-class="controller.cont_class">
    <div class="my_cat_title" data-tt-text="model.name"></div>
    <div class="my_cat_result">
      <span data-tt-text="model.cat_passed"></span> / <span data-tt-text="model.cat_count"></span>
      <tt-repeater data-tt-skip="!model.children" data-tt-model="model.children" class="my_cat_children" data-tt-class="controller.children_cont_class">
        <tt-cat-template data-tt-skip="model.type !== 'category'"></tt-cat-template>
        <tt-cat-child class="mmk" data-tt-skip="model.type !== 'test'"></tt-cat-child>
      </tt-repeater>
    </div>
  </div>

  <div id="tt-category-child" data-tt-class="controller.cont_class" data-tt-controller="fu-controller">
    <div data-tt-text="model.name + ' child'">
    </div>
  </div>
</div>
<div id="wowee">
</div>
</body>
</html>
